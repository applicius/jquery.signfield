!function(e){"use strict";var t=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},r=function(e){var t="object"!=typeof signField_I18N?null:signField_I18N[e];return t||"?"+e+"?"},a=function(t,r,a){var n=t.data("errors");return t.hasClass("has-error")||t.addClass("has-error"),e(".message",t).text(a),""!=e.trim(n)?t.data("errors",n+","+r):t.data("errors",r),t};e.fn.signField=function(n){var i=e(this);if("errors"==n){var s=[];return i.each(function(t,r){var a=e(r);if("yes"!=a.data("signature"))return!0;var n=a.data("errors");return""==e.trim(n)?!0:void(s=s.concat(n))}),s}if("filename"==n){var l=e('input[type="file"]',this).first();return 0==l.length?null:l.val()}if("imagedata"==n){var c=e('input[type="hidden"]',this).first();return 0==c.length?null:c.val()}if("selectiontype"==n){var o=e('input[type="radio"]:checked').first();return 0==o.length?null:o.val()}if(arguments&&arguments.length>=2){var u=arguments[0];if("addError"==u&&arguments.length>=3){var d=e(this).first();return 1!=d.length?d:a(d,arguments[1],arguments[2])}return i}var f=[];return i.each(function(n,i){var s=e(i),l=s.attr("id"),c=s.data("name"),o=s.attr("class"),u=e('<div class="'+o+'" id="'+l+'" data-signature="yes"></div>'),d=t()?e("<canvas></canvas>").appendTo(u):null,h=e('<input type="file" name="'+c+'-file" />').appendTo(u),g=h.get(0),v=e('<span class="message"></span>').appendTo(u),p=function(){return!0};if(g.files)try{var m=parseInt(s.data("max-size"));p=function(){var e=0==g.files.length?0:g.files[0].size/1024;e>m?a(u,"file.error.maxSize",r("file.error.maxSize").replace("{0}",e).replace("{1}",m)):(u.removeClass("has-error"),v.text(""))}}catch(s){}if(d){var y=s.data("pen-tickness")||2,k=e('<input type="hidden" value="" />').appendTo(u),b=d.get(0),x=function(){k.attr("name",c).val(b.toDataURL()),h.removeAttr("name");var t="",r=u.data("errors");""!=e.trim(r)&&e.each(r.split(","),function(r,a){return a&&a.length>11&&"file.error."==a.substring(0,11)?!0:void(""!=e.trim(a)&&(t+=a))}),u.data("errors",t),""==t&&u.removeClass("has-error")},C=function(){k.removeAttr("name"),h.attr("name",c),p()},z=e('<input type="radio" name="'+c+'-type" value="canvas" />').click(x),T=e('<input type="radio" name="'+c+'-type" value="file" />'),w=d.width(),A=d.height();T.change(function(){return""==e.trim(h.val())?(T.removeAttr("checked"),!1):void C()}),w&&d.attr("width",w),A&&d.attr("height",A),d.sketch({defaultColor:s.data("pen-color")||s.css("color")||"black",defaultSize:y}).on("click mousedown mouseup touchstart touchmove touchend touchcancel",function(){z.trigger("click"),u.trigger("change")}),e('<label class="radio sketch-radio">'+r("sketch.label")+"</label>").prepend(z).insertBefore(d),e('<a href="#clear" class="clear-canvas">'+r("sketch.clear")+"</a>").insertBefore(d).click(function(){return b.getContext("2d").clearRect(0,0,w,A),d.sketch("actions",[]),!1}),e('<label class="radio file-radio">'+r("file.label")+"</label>").prepend(T).insertBefore(h),h.change(function(){T.trigger("click")})}else h.attr("name",c);h.change(function(){p(),u.trigger("change")}),s.replaceWith(u),f.push(u.get(0))}),e(f)}}(jQuery);
