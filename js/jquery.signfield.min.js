!function(e){"use strict";var r=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},t=function(e){var r="object"!=typeof signField_I18N?null:signField_I18N[e];return r||"?"+e+"?"},a=function(r,t,a){var n=r.data("errors");return r.hasClass("has-error")||r.addClass("has-error"),e(".message",r).text(a),""!=e.trim(n)?r.data("errors",n+","+t):r.data("errors",t),r};e.fn.signField=function(n){var i=e(this);if("errors"==n){var s=[];return i.each(function(r,t){var a=e(t);if("yes"!=a.data("signature"))return!0;var n=a.data("errors");return""==e.trim(n)?!0:void(s=s.concat(n))}),s}if(arguments&&arguments.length>=2){var c=arguments[0];if("addError"==c&&arguments.length>=3){var o=e(this).first();return 1!=o.length?o:a(o,arguments[1],arguments[2])}return i}var l=[];return i.each(function(n,i){var s=e(i),c=s.attr("id"),o=s.data("name"),u=s.attr("class"),d=e('<div class="'+u+'" id="'+c+'" data-signature="yes"></div>'),f=r()?e("<canvas></canvas>").appendTo(d):null,h=e('<input type="file" name="'+o+'-file" />').appendTo(d),g=h.get(0),v=e('<span class="message"></span>').appendTo(d),m=function(){return!0};if(g.files)try{var p=parseInt(s.data("max-size"));m=function(){var e=0==g.files.length?0:g.files[0].size/1024;e>p?a(d,"file.error.maxSize",t("file.error.maxSize").replace("{0}",e).replace("{1}",p)):(d.removeClass("has-error"),v.text(""))}}catch(s){}if(f){var k=s.data("pen-tickness")||2,y=e('<input type="hidden" value="" />').appendTo(d),b=f.get(0),x=function(){y.attr("name",o).attr("value",b.toDataURL()),h.removeAttr("name");var r="",t=d.data("errors");""!=e.trim(t)&&e.each(t.split(","),function(t,a){return a&&a.length>11&&"file.error."==a.substring(0,11)?!0:void(""!=e.trim(a)&&(r+=a))}),d.data("errors",r),""==r&&d.removeClass("has-error")},C=function(){y.removeAttr("name"),h.attr("name",o),m()},z=e('<input type="radio" name="'+o+'-type" value="canvas" />').change(x),T=e('<input type="radio" name="'+o+'-type" value="file" />'),w=f.width(),A=f.height();T.change(function(){return""==e.trim(h.val())?(T.removeAttr("checked"),!1):void C()}),w&&f.attr("width",w),A&&f.attr("height",A),f.sketch({defaultColor:s.data("pen-color")||s.css("color")||"black",defaultSize:k}).on("click mousedown mouseup touchstart touchmove touchend touchcancel",function(){z.trigger("click"),d.trigger("change")}),e('<label class="radio sketch-radio">'+t("sketch.label")+"</label>").prepend(z).insertBefore(f),e('<a href="#clear" class="clear-canvas">'+t("sketch.clear")+"</a>").insertBefore(f).click(function(){return b.getContext("2d").clearRect(0,0,w,A),f.sketch("actions",[]),!1}),e('<label class="radio file-radio">'+t("file.label")+"</label>").prepend(T).insertBefore(h),h.change(function(){T.trigger("click")})}else h.attr("name",o);h.change(function(){m(),d.trigger("change")}),s.replaceWith(d),l.push(d.get(0))}),e(l)}}(jQuery);
