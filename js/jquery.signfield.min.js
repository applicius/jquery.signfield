!function(e){"use strict";var r=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},t=function(e){var r="object"!=typeof signField_I18N?null:signField_I18N[e];return r||"?"+e+"?"};e.fn.signField=function(a){var n=e(this);if("errors"==a){var i=[];return n.each(function(r,t){var a=e(t);if("yes"!=a.data("signature"))return!0;var n=a.data("errors");return""==e.trim(n)?!0:void(i=i.concat(n))}),i}var c=[];return n.each(function(a,n){var i=e(n),o=i.attr("id"),s=i.data("name"),l=i.attr("class"),u=e('<div class="'+l+'" id="'+o+'" data-signature="yes"></div>'),d=r()?e("<canvas></canvas>").appendTo(u):null,f=e('<input type="file" name="'+s+'-file" />').appendTo(u),h=f.get(0),v=e('<span class="message"></span>').appendTo(u),p=function(){return!0};if(h.files)try{var g=parseInt(i.data("max-size"));p=function(){var r=0==h.files.length?0:h.files[0].size/1024;if(r>g){var a=u.data("errors");u.addClass("has-error"),v.text(t("file.error.maxSize").replace("{0}",r).replace("{1}",g)),""!=e.trim(a)?u.data("errors",a+",file.error.maxSize"):u.data("errors","file.error.maxSize")}else u.removeClass("has-error"),v.text("")}}catch(i){}if(d){var m=i.data("pen-tickness")||2,k=e('<input type="hidden" value="" />').appendTo(u),y=d.get(0),b=function(){k.attr("name",s).attr("value",y.toDataURL()),f.removeAttr("name");var r="",t=u.data("errors");""!=e.trim(t)&&e.each(t.split(","),function(t,a){return a&&a.length>11&&"file.error."==a.substring(0,11)?!0:void(""!=e.trim(a)&&(r+=a))}),u.data("errors",r),""==r&&u.removeClass("has-error")},x=function(){k.removeAttr("name"),f.attr("name",s),p()},C=e('<input type="radio" name="'+s+'-type" value="canvas" />').change(b),z=e('<input type="radio" name="'+s+'-type" value="file" />'),S=d.width(),T=d.height();z.change(function(){return""==e.trim(f.val())?(z.removeAttr("checked"),!1):void x()}),S&&d.attr("width",S),T&&d.attr("height",T),d.sketch({defaultColor:i.data("pen-color")||i.css("color")||"black",defaultSize:m}).on("click mousedown mouseup touchstart touchmove touchend touchcancel",function(){C.trigger("click"),u.trigger("change")}),e('<label class="radio sketch-radio">'+t("sketch.label")+"</label>").prepend(C).insertBefore(d),e('<a href="#clear" class="clear-canvas">'+t("sketch.clear")+"</a>").insertBefore(d).click(function(){return y.getContext("2d").clearRect(0,0,S,T),d.sketch("actions",[]),!1}),e('<label class="radio file-radio">'+t("file.label")+"</label>").prepend(z).insertBefore(f),f.change(function(){z.trigger("click")})}else f.attr("name",s);f.change(function(){p(),u.trigger("change")}),i.replaceWith(u),c.push(u.get(0))}),e(c)}}(jQuery);
